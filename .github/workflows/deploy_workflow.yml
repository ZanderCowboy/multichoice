---
name: Deploy Apps
on:
  push:
    branches:
      - "main"
  pull_request:
    branches:
      - "main"
  workflow_run:
    workflows:
      - "Test, Analyze, Build"
    types:
      - "completed"
    branches:
      - "main"

  # workflow_dispatch:

jobs:
  pre-deploy:
    name: Pre-deploy
    runs-on: ubuntu-latest
    if: github.event.workflow_run.conclusion == 'success'
    # if: |
    #   (${{github.event_name == 'pull_request'}} && ${{github.event.action == 'opened'}} && ${{github.event.pull_request.base.ref == 'main'}}) ||
    #   (${{github.event.workflow_run.conclusion == 'success'}} && ${{github.ref == 'refs/heads/main'}})
    steps:
      - run: echo "Predeploy Job Finished"

  deploy:
    name: Deploy Apps
    if: github.event.pull_request.draft == false
    uses: ./.github/workflows/_deploy-env-apps.yml
    needs: pre-deploy
    permissions:
      contents: write
    secrets: inherit
    with:
      web-environment-flag: "Web Prod"
      android-environment-flag: "Android Prod"
      android-package-name: "co.za.zanderkotze.multichoice"
      android-deploy-status: "draft"
      windows-environment-flag: "Windows Prod"
